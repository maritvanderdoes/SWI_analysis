# Package notes:

## Main functions
The package has two main functions for the average user. These functions are tuned in such a way that are friendly to use and requires little to no knowledge. For a more detailed description
- <code>swi_analysis_mcherry.py</code>: runs the analysis workflow and saves it in <code>results.csv</code>. For a description of this function, see **Analysis workflow** down below.
- <code>plot_complete_dataset.py</code>: plots the results from the workflow.

## File formatting
Files are assumed to be of the form of <code>basename_tX_sY_additionainfo.extension</code>, where <code>X</code> is a number indicating the frame and <code>Y</code> is a number indicating the stage position. Channel and worm label are encoded in <code>additionalinfo</code>. Allowed extensions are <code>.stk</code> and <code>.tiff</code>.

Alternatively, files of the form <code>basename_sY_tX_additionainfo.extension</code> can be read, by setting the <code>data_format = 'st'</code> in <code>utils.read_image_and_metadata.py</code>. Other forms will lead to error or spurious results.

## The *Utils* package
These algorithms requires of our own package, utils. This package can be found in the repository and it is installed with the rest of the functions. 

## Analysis workflow
Here is a sketch on the operations that the main analysis code, <code>swi_analysis_mcherry.py</code>, performs:
1. Determines the files within a folder with the corresponding channels (masking and signal, mCherry and GFP). This is performed by <code>image_lists.py</code>.
2. Iterates over each file, loading one at a time. The information about position and time is retrieved. This is performed by <code>read_image_and_metadata.py</code>.
3. Using the masking channel (mCherry), a mask is generated. This is performed by <code>adaptive_masking.py</code>. For a detailed analysis in this function see [here](funs/adaptive_masking.md).
4. Worm properties are measured using the masking channel (mCherry) on the signal channel (GFP). Computed properties are _area_, _mean intensity_ and _min intensity_. This is performed by <code>calculate_worm_properties.py</code>. 
5. _(NOT AVAILABLE IN THE CURRENT VERSION)_ If selected, the worm is straigthened. 
6. _(NOT AVAILABLE IN THE CURRENT VERSION)_ Using the straigthening information, the head and the tail are operated.
7. Properties are saved on <code>results.csv</code>. 

## Plotting algorithm
Here is a sketch on the operations that the main analysis code, <code>plot_complete_dataset.py</code> and how to operate:
- Dataset...

## Development and troubleshooting code
### Main development and troubleshooting scripts
The advanced user of the package can found some more detailed code with higher flexibility. These scripts for test and development are the following:
- <code>Development_with_synth.py</code>: Development code using synthetic data. This is created to test the performance of the different algorithms for the workflow. Current synthetic datasets are:
  - 3D ball. This is generated by using <code>Generating_ball.py</code> from <code>utils.synthdata</code>.
- <code>Development_with_data.py</code>: Development code using imaging data. This code declares explicitly whether
  - The input data is downscaled. To activate this, set <code>dwnscal</code> to <code>True</code>.
  - The output from the masking algorithm is plottled. To activate this, set <code>plttng</code> to <code>True</code>.
  - The masking and masked data are saved. To activate this, set <code>svngfl</code> to <code>True</code>.
  - The verbose mode is activate. This gives extra output about the different steps performed and the time taken. To activate this, set <code>verbosity</code> to <code>True</code>.
  - If the package <code>utils</code> is not installed, then <code>_setup.py</code> adds the folder to the path.
  - To avoid crowding, general information is saved in <code>_parameters.py</code>. This is useful for automatic activation and cross-compability between developers.
- <code>swi_analysis_mcherry_troubleshooting.py</code>: This code is intentionally developed to be run as <code>swi_analysis_mcherry.py</code>. This code additionally:
  - Prints and stores elapsed time.
  - Computes and stores the centroids of the worm.
  - Saves the mask and the masked data.

### Additional development and troubleshooting functions
Additional useful codes are
- Time computation and downscaling code can be found in the submodule <code>benchmarking</code> in <code>utils</code>.
- Plotting output codes be found in <code>utils.plotting</code>.

## Deprecated code
Deprecated code can be found on the submodule <code>deprecated</code> in <code>utils</code>.

## Additional information and complementary packages
A note on this package, it seems that the version of scikit-image might be 0.15 instead of 0.17.
